import{r as f,a as S,j as e,u as E,H as U,L as P}from"./app-ys--rCFb.js";import{A as V}from"./AuthenticatedLayout-CDElrPoQ.js";import{I as _}from"./InputLabel-C0k9PNd4.js";import{I as w,T as H}from"./TextInput-TvvR9DYv.js";import{c as m}from"./createLucideIcon-CeFLNY3S.js";import{a as M,C as O,L as A}from"./loader-circle-BES32tS0.js";import{M as X,A as L}from"./message-square-Jt0dH5_t.js";import"./ApplicationLogo-UpmnVz5U.js";import"./transition-CQh0fXKB.js";const G=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Y=m("building-2",G);const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],$=m("circle-check",J);const Q=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],W=m("credit-card",Q);const K=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Z=m("pen-line",K);const ee=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],se=m("trending-down",ee);const te=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ae=m("trending-up",te);const re=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ie=m("triangle-alert",re);const ne=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],de=m("upload",ne);const oe=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],le=m("wand-sparkles",oe),p=(...t)=>t.filter(Boolean).join(" "),ce=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t),me=(t,x)=>{if(x.narration_sub_head_id)for(const d of t){const i=(d.active_sub_heads||d.sub_heads||[]).find(a=>a.id===x.narration_sub_head_id);if(i)return{head:d,subHead:i}}if(x.narration_head_id){const d=t.find(l=>l.id===x.narration_head_id);if(d)return{head:d,subHead:null}}return{head:null,subHead:null}};function F({transaction:t,heads:x=[]}){const d=t.type==="credit",l=x.filter(s=>s.type===t.type||s.type==="both"),i=t.review_status!=="pending",a=f.useMemo(()=>me(l,t),[l,t]),[y,g]=f.useState(!1),[c,b]=f.useState(a?.head??null),[n,o]=f.useState(a?.subHead??null),[j,N]=f.useState(!1),{data:u,setData:h,post:k,processing:r,errors:v,reset:R}=S({narration_head_id:a?.head?.id??"",narration_sub_head_id:a?.subHead?.id??"",party_name:t.party_name??"",narration_note:t.narration_note??"",save_as_rule:!1}),D=s=>{b(s),o(null),h(q=>({...q,narration_head_id:s.id,narration_sub_head_id:""}))},I=s=>{n?.id===s.id?(o(null),h("narration_sub_head_id","")):(o(s),h("narration_sub_head_id",s.id))},B=()=>{if(!u.narration_head_id){g(!0);return}C()},C=s=>{s&&s.preventDefault(),k(route("banking.transactions.review",{transaction:t.id,action:"correct"}),{preserveScroll:!0,onSuccess:()=>g(!1)})},T=()=>{g(!1),b(a?.head??null),o(a?.subHead??null),N(!1),R()},z=c?.active_sub_heads||c?.sub_heads||[];return e.jsxs("div",{className:p("rounded-2xl shadow-sm border overflow-hidden transition-all relative",i?"bg-gray-50 border-gray-200":"bg-white border-gray-100"),children:[t.is_uncertain&&!i&&e.jsxs("div",{className:"absolute top-2 right-4 flex items-center gap-1 text-amber-500 bg-amber-50 px-2 py-1 rounded text-xs font-bold ring-1 ring-amber-200",children:[e.jsx(ie,{size:12})," Low Confidence"]}),e.jsx("div",{className:p("text-white text-[10px] font-bold px-4 py-1.5 text-center tracking-widest uppercase",i?"bg-emerald-500":"bg-indigo-600"),children:i?"Reviewed":"Pending"}),e.jsx("div",{className:"p-5 sm:p-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:p("flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center",d?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"),children:d?e.jsx(ae,{size:24}):e.jsx(se,{size:24})}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("h3",{className:p("text-lg font-semibold mb-1",i?"text-gray-600":"text-gray-800"),children:[ce(t.amount)," ",d?"received":"debit for"," ",u.party_name?`'${u.party_name}'`:""]}),e.jsx("p",{className:"text-sm text-gray-500 font-mono mb-4",children:t.raw_narration}),y?e.jsxs("form",{onSubmit:C,className:"mt-4 animate-in fade-in duration-200 border-t border-gray-200 pt-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx(_,{value:"1. Select Head *",className:"mb-2 text-gray-500 uppercase text-[10px] tracking-widest font-bold"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:l.map(s=>e.jsx("button",{type:"button",onClick:()=>D(s),className:p("flex items-center justify-center rounded-xl border-2 py-2 px-2 text-xs font-bold transition-all",c?.id===s.id?"border-indigo-600 bg-indigo-50 text-indigo-700 shadow-sm":"border-gray-100 bg-white text-gray-500 hover:border-gray-300"),children:s.name},s.id))}),e.jsx(w,{message:v.narration_head_id,className:"mt-2"})]}),c&&z.length>0&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(_,{value:"2. Sub-Head (Optional)",className:"mb-2 text-gray-500 uppercase text-[10px] tracking-widest font-bold"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:z.map(s=>e.jsxs("button",{type:"button",onClick:()=>I(s),className:p("flex items-center justify-between rounded-xl border-2 px-4 py-2.5 text-left text-sm font-medium transition-all",n?.id===s.id?"border-gray-900 bg-gray-900 text-white shadow-md":"border-gray-100 bg-white text-gray-600 hover:border-gray-300"),children:[s.name,n?.id===s.id&&e.jsx("span",{className:"text-indigo-400",children:"●"})]},s.id))}),e.jsx(w,{message:v.narration_sub_head_id,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:`party_${t.id}`,value:n?.requires_party?"Party Name *":"Vendor Name (Optional)",className:"mb-1"}),e.jsx(H,{id:`party_${t.id}`,value:u.party_name,onChange:s=>h("party_name",s.target.value),className:"w-full bg-gray-50 border-gray-200 text-sm",placeholder:"Vendor/Person name",required:n?.requires_party}),e.jsx(w,{message:v.party_name,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:`note_${t.id}`,value:"Additional Note (Optional)",className:"mb-1"}),e.jsx(H,{id:`note_${t.id}`,value:u.narration_note,onChange:s=>h("narration_note",s.target.value),className:"w-full bg-gray-50 border-gray-200 text-sm",placeholder:"Add specific details..."}),e.jsx(w,{message:v.narration_note,className:"mt-1"})]})]}),e.jsx("div",{className:p("rounded-xl border-2 p-3.5 transition-colors",j?"border-indigo-100 bg-indigo-50/30":"border-gray-50 bg-gray-50/50"),children:e.jsxs("label",{className:"flex cursor-pointer items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:s=>{N(s.target.checked),h("save_as_rule",s.target.checked)},className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800",children:"Auto-categorize in future?"}),e.jsx("span",{className:"text-[10px] text-gray-500 leading-tight",children:"Remember this choice for similar narrations."})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:T,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-xl transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!c||r,className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white text-sm font-semibold rounded-xl shadow-sm transition-colors",children:r?"Saving...":i?"Update Details":"Confirm Details"})]})]}):e.jsxs(e.Fragment,{children:[!i&&(t.reasoning||a?.head)&&e.jsxs("div",{className:"bg-[#F8FAFC] border border-indigo-50 rounded-xl p-3 mb-5 flex gap-3 text-sm text-gray-500 italic",children:[e.jsx(le,{size:16,className:"text-indigo-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[a?.head&&e.jsxs("span",{className:"block not-italic font-semibold text-indigo-700 mb-0.5",children:["Suggested: ",a.head.name," ",a.subHead?`→ ${a.subHead.name}`:""]}),e.jsxs("p",{children:["Narration: ",t.narration_note]}),e.jsx("br",{}),e.jsx("p",{children:t.reasoning||"AI mapped this based on similar patterns."})]})]}),i&&a?.head&&e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 rounded-xl p-3 mb-5 flex gap-3 text-sm",children:[e.jsx(M,{size:18,className:"text-emerald-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("span",{className:"block font-semibold text-emerald-800 mb-0.5",children:["Categorized as: ",a.head.name," ",a.subHead?`→ ${a.subHead.name}`:""]}),t.narration_note&&e.jsxs("p",{className:"text-emerald-600/80 italic text-xs",children:["Note: ",t.narration_note]})]})]}),e.jsx("div",{className:"flex gap-3",children:i?e.jsxs("button",{onClick:()=>g(!0),className:"w-full bg-white border-2 border-gray-200 hover:border-gray-300 text-gray-600 font-semibold py-2 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Z,{size:18})," Edit"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:B,disabled:r,className:"flex-1 bg-[#10B981] hover:bg-[#059669] disabled:opacity-50 text-white font-semibold py-2.5 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors",children:[e.jsx(M,{size:20})," Yes, Confirm"]}),e.jsx("button",{onClick:()=>g(!0),className:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2.5 px-4 rounded-xl transition-colors",children:a?.head?"Enter Narration":"Categorize"})]})})]})]})]})})]})}function xe(){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-50 border-2 border-amber-200 rounded-2xl flex items-center justify-center mb-5",children:e.jsx(Y,{className:"text-amber-500",size:28})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"No Business Profile Found"}),e.jsx("p",{className:"text-gray-500 text-sm max-w-xs mb-6 leading-relaxed",children:"You need to set up your business profile before you can manage banking transactions."}),e.jsxs(P,{href:route("accounting.chat"),className:"inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold px-5 py-2.5 rounded-xl transition-colors shadow-sm",children:["Set Up Business",e.jsx(L,{size:15})]})]})}function ge(){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 border-2 border-blue-200 rounded-2xl flex items-center justify-center mb-5",children:e.jsx(W,{className:"text-blue-500",size:28})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"No Bank Account Added"}),e.jsx("p",{className:"text-gray-500 text-sm max-w-xs mb-6 leading-relaxed",children:"Add a bank account to your company profile to start tracking and reviewing transactions."}),e.jsxs(P,{href:route("accounting.chat"),className:"inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold px-5 py-2.5 rounded-xl transition-colors shadow-sm",children:["Add Bank Account",e.jsx(L,{size:15})]})]})}function he(){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-14 px-6 text-center",children:[e.jsx("div",{className:"w-14 h-14 bg-emerald-50 border-2 border-emerald-200 rounded-2xl flex items-center justify-center mb-4",children:e.jsx($,{className:"text-emerald-500",size:24})}),e.jsx("h3",{className:"text-base font-semibold text-gray-700 mb-1",children:"All caught up!"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"No transactions to review right now."})]})}function we({auth:t,transactions:x,heads:d,bankAccounts:l=[],hasCompany:i=!0}){const{flash:a}=E().props,y=l.length===0,g=x?.data||[],c=g.filter(r=>r.review_status==="pending"),b=g.filter(r=>r.review_status!=="pending"),n=S({bank_account_id:l.length>0?l[0].id:"",raw_sms:""}),o=S({bank_account_id:l.length>0?l[0].id:"",statement:null}),j=r=>{r.preventDefault(),n.post(route("banking.transactions.sms.ingest"),{onSuccess:()=>n.reset("raw_sms")})},N=r=>{r.preventDefault(),o.post(route("banking.transactions.statement.upload"),{forceFormData:!0,onSuccess:()=>o.reset("statement")})},u=!i,h=i&&y,k=i&&!y;return e.jsxs(V,{user:t.user,children:[e.jsx(U,{title:"Pending Reviews"}),e.jsxs("div",{className:"max-w-2xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Narration"}),e.jsx("p",{className:"text-sm text-gray-400 mt-0.5",children:"Review and categorise your transactions"})]}),a?.success&&e.jsxs("div",{className:"flex items-start gap-3 bg-emerald-50 text-emerald-700 p-4 rounded-xl border border-emerald-200 text-sm font-medium",children:[e.jsx($,{size:16,className:"mt-0.5 flex-shrink-0"}),a.success]}),a?.error&&e.jsxs("div",{className:"flex items-start gap-3 bg-red-50 text-red-700 p-4 rounded-xl border border-red-200 text-sm font-medium",children:[e.jsx(O,{size:16,className:"mt-0.5 flex-shrink-0"}),a.error]}),u&&e.jsx("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm",children:e.jsx(xe,{})}),h&&e.jsx("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm",children:e.jsx(ge,{})}),k&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-indigo-600 font-semibold",children:[e.jsx(X,{size:17}),e.jsx("h2",{className:"text-sm",children:"Paste Bank SMS"})]}),e.jsxs("form",{onSubmit:j,className:"space-y-3",children:[e.jsx("textarea",{placeholder:"Paste raw SMS text here...",value:n.data.raw_sms,onChange:r=>n.setData("raw_sms",r.target.value),className:"w-full bg-gray-50 border border-gray-200 text-gray-800 rounded-lg px-3 py-2 text-sm min-h-[90px] outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 resize-none"}),n.errors.raw_sms&&e.jsx("p",{className:"text-red-500 text-xs",children:n.errors.raw_sms}),e.jsxs("button",{type:"submit",disabled:n.processing||!n.data.raw_sms.trim(),className:"w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white font-medium py-2 rounded-lg text-sm transition-colors flex justify-center items-center gap-2",children:[n.processing&&e.jsx(A,{size:15,className:"animate-spin"}),"Process SMS"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-indigo-600 font-semibold",children:[e.jsx(de,{size:17}),e.jsx("h2",{className:"text-sm",children:"Upload Statement"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-3",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"file",accept:".pdf,.csv,.xls,.xlsx,.png,.jpg,.jpeg",onChange:r=>o.setData("statement",r.target.files[0]),className:`w-full bg-gray-50 border border-gray-200 text-gray-800 rounded-lg px-3 py-1.5 text-sm
                                                file:mr-3 file:py-1 file:px-3 file:rounded-md file:border-0
                                                file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700
                                                hover:file:bg-indigo-100 outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500`})}),o.errors.statement&&e.jsx("p",{className:"text-red-500 text-xs",children:o.errors.statement}),e.jsx("p",{className:"text-xs text-gray-400",children:"Supported: PDF, CSV, XLS, XLSX, PNG, JPG"}),e.jsxs("button",{type:"submit",disabled:o.processing||!o.data.statement,className:"w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white font-medium py-2 rounded-lg text-sm transition-colors flex justify-center items-center gap-2",children:[o.processing&&e.jsx(A,{size:15,className:"animate-spin"}),"Upload File"]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-5 mt-4",children:[e.jsx("div",{className:"w-1 h-5 bg-indigo-500 rounded-full"}),e.jsxs("h2",{className:"text-sm font-bold text-gray-700 uppercase tracking-widest flex items-center gap-2",children:["Pending Review",c.length>0&&e.jsx("span",{className:"bg-indigo-100 text-indigo-700 text-xs py-0.5 px-2 rounded-full font-bold",children:c.length})]})]}),c.length===0?e.jsx(he,{}):e.jsx("div",{className:"space-y-4",children:c.map(r=>e.jsx(F,{transaction:r,heads:d},r.id))})]}),b.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-5 mt-8",children:[e.jsx("div",{className:"w-1 h-5 bg-emerald-400 rounded-full"}),e.jsx("h2",{className:"text-sm font-bold text-gray-700 uppercase tracking-widest",children:"Recently Reviewed"})]}),e.jsx("div",{className:"space-y-4",children:b.map(r=>e.jsx(F,{transaction:r,heads:d},r.id))})]})]})]})]})}export{we as default};
