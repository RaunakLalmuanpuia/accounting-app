import{r as h,a as v,j as e,u as T,H as A}from"./app-CNocxYXr.js";import{A as q}from"./AuthenticatedLayout-VV3SuxUV.js";import{I as j}from"./InputLabel-CR72amFB.js";import{I as _,T as H}from"./TextInput-BHPzpbrL.js";import{c as g,C as M,L as E}from"./loader-circle-DvB_fwrp.js";import"./ApplicationLogo-BSoVjQ_p.js";import"./transition-BJz_rdc1.js";const B=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],U=g("message-square",B);const O=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],V=g("pen-line",O);const W=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Y=g("trending-down",W);const G=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Q=g("trending-up",G);const J=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],K=g("triangle-alert",J);const X=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Z=g("upload",X);const ee=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],se=g("wand-sparkles",ee),x=(...t)=>t.filter(Boolean).join(" "),te=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t),ae=(t,c)=>{if(c.narration_sub_head_id)for(const o of t){const i=(o.active_sub_heads||o.sub_heads||[]).find(a=>a.id===c.narration_sub_head_id);if(i)return{head:o,subHead:i}}if(c.narration_head_id){const o=t.find(l=>l.id===c.narration_head_id);if(o)return{head:o,subHead:null}}return{head:null,subHead:null}};function z({transaction:t,heads:c=[]}){const o=t.type==="credit",l=c.filter(s=>s.type===t.type||s.type==="both"),i=t.review_status!=="pending",a=h.useMemo(()=>ae(l,t),[l,t]),[b,n]=h.useState(!1),[d,f]=h.useState(a?.head??null),[m,r]=h.useState(a?.subHead??null),[w,k]=h.useState(!1),{data:u,setData:p,post:F,processing:N,errors:y,reset:P}=v({narration_head_id:a?.head?.id??"",narration_sub_head_id:a?.subHead?.id??"",party_name:t.party_name??"",narration_note:t.narration_note??"",save_as_rule:!1}),D=s=>{f(s),r(null),p(R=>({...R,narration_head_id:s.id,narration_sub_head_id:""}))},I=s=>{m?.id===s.id?(r(null),p("narration_sub_head_id","")):(r(s),p("narration_sub_head_id",s.id))},L=()=>{if(!u.narration_head_id){n(!0);return}S()},S=s=>{s&&s.preventDefault(),F(route("banking.transactions.review",{transaction:t.id,action:"correct"}),{preserveScroll:!0,onSuccess:()=>n(!1)})},$=()=>{n(!1),f(a?.head??null),r(a?.subHead??null),k(!1),P()},C=d?.active_sub_heads||d?.sub_heads||[];return e.jsxs("div",{className:x("rounded-2xl shadow-sm border overflow-hidden transition-all relative",i?"bg-gray-50 border-gray-200":"bg-white border-gray-100"),children:[t.is_uncertain&&!i&&e.jsxs("div",{className:"absolute top-2 right-4 flex items-center gap-1 text-amber-500 bg-amber-50 px-2 py-1 rounded text-xs font-bold ring-1 ring-amber-200",children:[e.jsx(K,{size:12})," Low Confidence"]}),e.jsx("div",{className:x("text-white text-[10px] font-bold px-4 py-1.5 text-center tracking-widest uppercase",i?"bg-emerald-500":"bg-indigo-600"),children:i?"Reviewed":"Pending"}),e.jsx("div",{className:"p-5 sm:p-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:x("flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center",o?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"),children:o?e.jsx(Q,{size:24}):e.jsx(Y,{size:24})}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("h3",{className:x("text-lg font-semibold mb-1",i?"text-gray-600":"text-gray-800"),children:[te(t.amount)," ",o?"received":"debit for"," ",u.party_name?`'${u.party_name}'`:""]}),e.jsx("p",{className:"text-sm text-gray-500 font-mono mb-4",children:t.raw_narration}),b?e.jsxs("form",{onSubmit:S,className:"mt-4 animate-in fade-in duration-200 border-t border-gray-200 pt-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx(j,{value:"1. Select Head *",className:"mb-2 text-gray-500 uppercase text-[10px] tracking-widest font-bold"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:l.map(s=>e.jsx("button",{type:"button",onClick:()=>D(s),className:x("flex items-center justify-center rounded-xl border-2 py-2 px-2 text-xs font-bold transition-all",d?.id===s.id?"border-indigo-600 bg-indigo-50 text-indigo-700 shadow-sm":"border-gray-100 bg-white text-gray-500 hover:border-gray-300"),children:s.name},s.id))}),e.jsx(_,{message:y.narration_head_id,className:"mt-2"})]}),d&&C.length>0&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(j,{value:"2. Sub-Head (Optional)",className:"mb-2 text-gray-500 uppercase text-[10px] tracking-widest font-bold"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:C.map(s=>e.jsxs("button",{type:"button",onClick:()=>I(s),className:x("flex items-center justify-between rounded-xl border-2 px-4 py-2.5 text-left text-sm font-medium transition-all",m?.id===s.id?"border-gray-900 bg-gray-900 text-white shadow-md":"border-gray-100 bg-white text-gray-600 hover:border-gray-300"),children:[s.name,m?.id===s.id&&e.jsx("span",{className:"text-indigo-400",children:"●"})]},s.id))}),e.jsx(_,{message:y.narration_sub_head_id,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:`party_${t.id}`,value:m?.requires_party?"Party Name *":"Vendor Name (Optional)",className:"mb-1"}),e.jsx(H,{id:`party_${t.id}`,value:u.party_name,onChange:s=>p("party_name",s.target.value),className:"w-full bg-gray-50 border-gray-200 text-sm",placeholder:"Vendor/Person name",required:m?.requires_party}),e.jsx(_,{message:y.party_name,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:`note_${t.id}`,value:"Additional Note (Optional)",className:"mb-1"}),e.jsx(H,{id:`note_${t.id}`,value:u.narration_note,onChange:s=>p("narration_note",s.target.value),className:"w-full bg-gray-50 border-gray-200 text-sm",placeholder:"Add specific details..."}),e.jsx(_,{message:y.narration_note,className:"mt-1"})]})]}),e.jsx("div",{className:x("rounded-xl border-2 p-3.5 transition-colors",w?"border-indigo-100 bg-indigo-50/30":"border-gray-50 bg-gray-50/50"),children:e.jsxs("label",{className:"flex cursor-pointer items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>{k(s.target.checked),p("save_as_rule",s.target.checked)},className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800",children:"Auto-categorize in future?"}),e.jsx("span",{className:"text-[10px] text-gray-500 leading-tight",children:"Remember this choice for similar narrations."})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:$,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-xl transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!d||N,className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white text-sm font-semibold rounded-xl shadow-sm transition-colors",children:N?"Saving...":i?"Update Details":"Confirm Details"})]})]}):e.jsxs(e.Fragment,{children:[!i&&(t.reasoning||a?.head)&&e.jsxs("div",{className:"bg-[#F8FAFC] border border-indigo-50 rounded-xl p-3 mb-5 flex gap-3 text-sm text-gray-500 italic",children:[e.jsx(se,{size:16,className:"text-indigo-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[a?.head&&e.jsxs("span",{className:"block not-italic font-semibold text-indigo-700 mb-0.5",children:["Suggested: ",a.head.name," ",a.subHead?`→ ${a.subHead.name}`:""]}),e.jsxs("p",{children:["Narration: ",t.narration_note]}),e.jsx("br",{}),e.jsx("p",{children:t.reasoning||"AI mapped this based on similar patterns."})]})]}),i&&a?.head&&e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 rounded-xl p-3 mb-5 flex gap-3 text-sm",children:[e.jsx(M,{size:18,className:"text-emerald-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("span",{className:"block font-semibold text-emerald-800 mb-0.5",children:["Categorized as: ",a.head.name," ",a.subHead?`→ ${a.subHead.name}`:""]}),t.narration_note&&e.jsxs("p",{className:"text-emerald-600/80 italic text-xs",children:["Note: ",t.narration_note]})]})]}),e.jsx("div",{className:"flex gap-3",children:i?e.jsxs("button",{onClick:()=>n(!0),className:"w-full bg-white border-2 border-gray-200 hover:border-gray-300 text-gray-600 font-semibold py-2 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors",children:[e.jsx(V,{size:18})," Edit"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:L,disabled:N,className:"flex-1 bg-[#10B981] hover:bg-[#059669] disabled:opacity-50 text-white font-semibold py-2.5 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors",children:[e.jsx(M,{size:20})," Yes, Confirm"]}),e.jsx("button",{onClick:()=>n(!0),className:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2.5 px-4 rounded-xl transition-colors",children:a?.head?"Enter Narration":"Categorize"})]})})]})]})]})})]})}function me({auth:t,transactions:c,heads:o,bankAccounts:l=[]}){const{flash:i}=T().props,a=c?.data?.filter(r=>r.review_status==="pending")||[],b=c?.data?.filter(r=>r.review_status!=="pending")||[],n=v({bank_account_id:l.length>0?l[0].id:"",raw_sms:""}),d=v({bank_account_id:l.length>0?l[0].id:"",statement:null}),f=r=>{r.preventDefault(),n.post(route("banking.transactions.sms.ingest"),{onSuccess:()=>n.reset("raw_sms")})},m=r=>{r.preventDefault(),d.post(route("banking.transactions.statement.upload"),{forceFormData:!0,onSuccess:()=>d.reset("statement")})};return e.jsxs(q,{user:t.user,children:[e.jsx(A,{title:"Pending Reviews"}),e.jsxs("div",{className:"max-w-2xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-10",children:[i?.success&&e.jsx("div",{className:"bg-emerald-50 text-emerald-700 p-4 rounded-xl border border-emerald-200 text-sm font-medium",children:i.success}),e.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-indigo-600 font-semibold",children:[e.jsx(U,{size:18}),e.jsx("h2",{children:"Paste Bank SMS"})]}),e.jsxs("form",{onSubmit:f,className:"space-y-3",children:[e.jsx("textarea",{placeholder:"Paste raw SMS text here...",value:n.data.raw_sms,onChange:r=>n.setData("raw_sms",r.target.value),className:"w-full bg-gray-50 border border-gray-200 text-gray-800 rounded-lg px-3 py-2 text-sm min-h-[80px] outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"}),n.errors.raw_sms&&e.jsx("div",{className:"text-red-500 text-xs",children:n.errors.raw_sms}),e.jsxs("button",{disabled:n.processing,className:"w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-70 text-white font-medium py-2 rounded-lg text-sm transition-colors flex justify-center items-center gap-2",children:[n.processing&&e.jsx(E,{size:16,className:"animate-spin"}),"Process SMS"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-indigo-600 font-semibold",children:[e.jsx(Z,{size:18}),e.jsx("h2",{children:"Upload Statement"})]}),e.jsxs("form",{onSubmit:m,className:"space-y-3",children:[e.jsx("input",{type:"file",accept:".pdf,.csv,.xls,.xlsx,.png,.jpg,.jpeg",onChange:r=>d.setData("statement",r.target.files[0]),className:"w-full bg-gray-50 border border-gray-200 text-gray-800 rounded-lg px-3 py-1.5 text-sm file:mr-4 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"}),d.errors.statement&&e.jsx("div",{className:"text-red-500 text-xs",children:d.errors.statement}),e.jsxs("button",{disabled:d.processing||!d.data.statement,className:"w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-70 text-white font-medium py-2 rounded-lg text-sm transition-colors mt-auto flex justify-center items-center gap-2",children:[d.processing&&e.jsx(E,{size:16,className:"animate-spin"}),"Upload File"]})]})]})]}),a.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 mt-10",children:[e.jsx("div",{className:"w-1.5 h-6 bg-[#4F46E5] rounded-full"}),e.jsxs("h1",{className:"text-lg font-bold text-[#1E293B] tracking-tight flex items-center gap-3",children:["PENDING REVIEW",e.jsx("span",{className:"bg-[#E0E7FF] text-[#4338CA] text-xs py-0.5 px-2.5 rounded-full font-bold",children:a.length})]})]}),e.jsx("div",{className:"space-y-6",children:a.map(r=>e.jsx(z,{transaction:r,heads:o},r.id))})]}),b.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 mt-12",children:[e.jsx("div",{className:"w-1.5 h-6 bg-[#10B981] rounded-full"}),e.jsx("h1",{className:"text-lg font-bold text-[#1E293B] tracking-tight flex items-center gap-3",children:"RECENTLY COMPLETED"})]}),e.jsx("div",{className:"space-y-6",children:b.map(r=>e.jsx(z,{transaction:r,heads:o},r.id))})]})]})]})}export{me as default};
