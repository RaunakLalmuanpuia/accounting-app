import{r as m,u as N,j as e,a as q,H as B}from"./app-D94uvTFq.js";import{A as U}from"./AuthenticatedLayout-BxBxxjF3.js";import{I as j}from"./InputLabel-DRAteG--.js";import{I as _,T as H}from"./TextInput-qiN91bou.js";import"./ApplicationLogo-DMMqz7-x.js";import"./transition-BqwhFnJi.js";const F=(...s)=>s.filter((r,n,d)=>!!r&&r.trim()!==""&&d.indexOf(r)===n).join(" ").trim();const O=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const V=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(r,n,d)=>d?d.toUpperCase():n.toLowerCase());const M=s=>{const r=V(s);return r.charAt(0).toUpperCase()+r.slice(1)};var W={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Y=s=>{for(const r in s)if(r.startsWith("aria-")||r==="role"||r==="title")return!0;return!1};const Z=m.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:n=2,absoluteStrokeWidth:d,className:o="",children:a,iconNode:p,...l},c)=>m.createElement("svg",{ref:c,...W,width:r,height:r,stroke:s,strokeWidth:d?Number(n)*24/Number(r):n,className:F("lucide",o),...!a&&!Y(l)&&{"aria-hidden":"true"},...l},[...p.map(([h,x])=>m.createElement(h,x)),...Array.isArray(a)?a:[a]]));const g=(s,r)=>{const n=m.forwardRef(({className:d,...o},a)=>m.createElement(Z,{ref:a,iconNode:r,className:F(`lucide-${O(M(s))}`,`lucide-${s}`,d),...o}));return n.displayName=M(s),n};const G=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],E=g("check",G);const K=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],$=g("loader-circle",K);const Q=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],J=g("message-square",Q);const X=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ee=g("pen-line",X);const se=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],te=g("trending-down",se);const ae=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],re=g("trending-up",ae);const ne=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ie=g("triangle-alert",ne);const de=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],oe=g("upload",de);const le=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],ce=g("wand-sparkles",le),u=(...s)=>s.filter(Boolean).join(" "),me=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s),xe=(s,r)=>{if(r.narration_sub_head_id)for(const n of s){const o=(n.active_sub_heads||n.sub_heads||[]).find(a=>a.id===r.narration_sub_head_id);if(o)return{head:n,subHead:o}}if(r.narration_head_id){const n=s.find(d=>d.id===r.narration_head_id);if(n)return{head:n,subHead:null}}return{head:null,subHead:null}};function z({transaction:s,heads:r=[]}){const n=s.type==="credit",d=r.filter(t=>t.type===s.type||t.type==="both"),o=s.review_status!=="pending",a=m.useMemo(()=>xe(d,s),[d,s]),[p,l]=m.useState(!1),[c,h]=m.useState(a?.head??null),[x,i]=m.useState(a?.subHead??null),[w,k]=m.useState(!1),{data:f,setData:b,post:L,processing:v,errors:y,reset:P}=N({narration_head_id:a?.head?.id??"",narration_sub_head_id:a?.subHead?.id??"",party_name:s.party_name??"",narration_note:s.narration_note??"",save_as_rule:!1}),A=t=>{h(t),i(null),b(T=>({...T,narration_head_id:t.id,narration_sub_head_id:""}))},I=t=>{x?.id===t.id?(i(null),b("narration_sub_head_id","")):(i(t),b("narration_sub_head_id",t.id))},D=()=>{if(!f.narration_head_id){l(!0);return}C()},C=t=>{t&&t.preventDefault(),L(route("banking.transactions.review",{transaction:s.id,action:"correct"}),{preserveScroll:!0,onSuccess:()=>l(!1)})},R=()=>{l(!1),h(a?.head??null),i(a?.subHead??null),k(!1),P()},S=c?.active_sub_heads||c?.sub_heads||[];return e.jsxs("div",{className:u("rounded-2xl shadow-sm border overflow-hidden transition-all relative",o?"bg-gray-50 border-gray-200":"bg-white border-gray-100"),children:[s.is_uncertain&&!o&&e.jsxs("div",{className:"absolute top-2 right-4 flex items-center gap-1 text-amber-500 bg-amber-50 px-2 py-1 rounded text-xs font-bold ring-1 ring-amber-200",children:[e.jsx(ie,{size:12})," Low Confidence"]}),e.jsx("div",{className:u("text-white text-[10px] font-bold px-4 py-1.5 text-center tracking-widest uppercase",o?"bg-emerald-500":"bg-indigo-600"),children:o?"Reviewed":"Pending"}),e.jsx("div",{className:"p-5 sm:p-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:u("flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center",n?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"),children:n?e.jsx(re,{size:24}):e.jsx(te,{size:24})}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("h3",{className:u("text-lg font-semibold mb-1",o?"text-gray-600":"text-gray-800"),children:[me(s.amount)," ",n?"received":"debit for"," ",f.party_name?`'${f.party_name}'`:""]}),e.jsx("p",{className:"text-sm text-gray-500 font-mono mb-4",children:s.raw_narration}),p?e.jsxs("form",{onSubmit:C,className:"mt-4 animate-in fade-in duration-200 border-t border-gray-200 pt-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx(j,{value:"1. Select Head *",className:"mb-2 text-gray-500 uppercase text-[10px] tracking-widest font-bold"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:d.map(t=>e.jsx("button",{type:"button",onClick:()=>A(t),className:u("flex items-center justify-center rounded-xl border-2 py-2 px-2 text-xs font-bold transition-all",c?.id===t.id?"border-indigo-600 bg-indigo-50 text-indigo-700 shadow-sm":"border-gray-100 bg-white text-gray-500 hover:border-gray-300"),children:t.name},t.id))}),e.jsx(_,{message:y.narration_head_id,className:"mt-2"})]}),c&&S.length>0&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(j,{value:"2. Sub-Head (Optional)",className:"mb-2 text-gray-500 uppercase text-[10px] tracking-widest font-bold"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:S.map(t=>e.jsxs("button",{type:"button",onClick:()=>I(t),className:u("flex items-center justify-between rounded-xl border-2 px-4 py-2.5 text-left text-sm font-medium transition-all",x?.id===t.id?"border-gray-900 bg-gray-900 text-white shadow-md":"border-gray-100 bg-white text-gray-600 hover:border-gray-300"),children:[t.name,x?.id===t.id&&e.jsx("span",{className:"text-indigo-400",children:"●"})]},t.id))}),e.jsx(_,{message:y.narration_sub_head_id,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:`party_${s.id}`,value:x?.requires_party?"Party Name *":"Vendor Name (Optional)",className:"mb-1"}),e.jsx(H,{id:`party_${s.id}`,value:f.party_name,onChange:t=>b("party_name",t.target.value),className:"w-full bg-gray-50 border-gray-200 text-sm",placeholder:"Vendor/Person name",required:x?.requires_party}),e.jsx(_,{message:y.party_name,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:`note_${s.id}`,value:"Additional Note (Optional)",className:"mb-1"}),e.jsx(H,{id:`note_${s.id}`,value:f.narration_note,onChange:t=>b("narration_note",t.target.value),className:"w-full bg-gray-50 border-gray-200 text-sm",placeholder:"Add specific details..."}),e.jsx(_,{message:y.narration_note,className:"mt-1"})]})]}),e.jsx("div",{className:u("rounded-xl border-2 p-3.5 transition-colors",w?"border-indigo-100 bg-indigo-50/30":"border-gray-50 bg-gray-50/50"),children:e.jsxs("label",{className:"flex cursor-pointer items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:t=>{k(t.target.checked),b("save_as_rule",t.target.checked)},className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800",children:"Auto-categorize in future?"}),e.jsx("span",{className:"text-[10px] text-gray-500 leading-tight",children:"Remember this choice for similar narrations."})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:R,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-xl transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!c||v,className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white text-sm font-semibold rounded-xl shadow-sm transition-colors",children:v?"Saving...":o?"Update Details":"Confirm Details"})]})]}):e.jsxs(e.Fragment,{children:[!o&&(s.reasoning||a?.head)&&e.jsxs("div",{className:"bg-[#F8FAFC] border border-indigo-50 rounded-xl p-3 mb-5 flex gap-3 text-sm text-gray-500 italic",children:[e.jsx(ce,{size:16,className:"text-indigo-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[a?.head&&e.jsxs("span",{className:"block not-italic font-semibold text-indigo-700 mb-0.5",children:["Suggested: ",a.head.name," ",a.subHead?`→ ${a.subHead.name}`:""]}),e.jsxs("p",{children:["Narration: ",s.narration_note]}),e.jsx("br",{}),e.jsx("p",{children:s.reasoning||"AI mapped this based on similar patterns."})]})]}),o&&a?.head&&e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 rounded-xl p-3 mb-5 flex gap-3 text-sm",children:[e.jsx(E,{size:18,className:"text-emerald-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("span",{className:"block font-semibold text-emerald-800 mb-0.5",children:["Categorized as: ",a.head.name," ",a.subHead?`→ ${a.subHead.name}`:""]}),s.narration_note&&e.jsxs("p",{className:"text-emerald-600/80 italic text-xs",children:["Note: ",s.narration_note]})]})]}),e.jsx("div",{className:"flex gap-3",children:o?e.jsxs("button",{onClick:()=>l(!0),className:"w-full bg-white border-2 border-gray-200 hover:border-gray-300 text-gray-600 font-semibold py-2 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors",children:[e.jsx(ee,{size:18})," Edit"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:D,disabled:v,className:"flex-1 bg-[#10B981] hover:bg-[#059669] disabled:opacity-50 text-white font-semibold py-2.5 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors",children:[e.jsx(E,{size:20})," Yes, Confirm"]}),e.jsx("button",{onClick:()=>l(!0),className:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2.5 px-4 rounded-xl transition-colors",children:a?.head?"Enter Narration":"Categorize"})]})})]})]})]})})]})}function ye({auth:s,transactions:r,heads:n,bankAccounts:d=[]}){const{flash:o}=q().props,a=r?.data?.filter(i=>i.review_status==="pending")||[],p=r?.data?.filter(i=>i.review_status!=="pending")||[],l=N({bank_account_id:d.length>0?d[0].id:"",raw_sms:""}),c=N({bank_account_id:d.length>0?d[0].id:"",statement:null}),h=i=>{i.preventDefault(),l.post(route("banking.transactions.sms.ingest"),{onSuccess:()=>l.reset("raw_sms")})},x=i=>{i.preventDefault(),c.post(route("banking.transactions.statement.upload"),{forceFormData:!0,onSuccess:()=>c.reset("statement")})};return e.jsxs(U,{user:s.user,children:[e.jsx(B,{title:"Pending Reviews"}),e.jsxs("div",{className:"max-w-2xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-10",children:[o?.success&&e.jsx("div",{className:"bg-emerald-50 text-emerald-700 p-4 rounded-xl border border-emerald-200 text-sm font-medium",children:o.success}),e.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-indigo-600 font-semibold",children:[e.jsx(J,{size:18}),e.jsx("h2",{children:"Paste Bank SMS"})]}),e.jsxs("form",{onSubmit:h,className:"space-y-3",children:[e.jsx("textarea",{placeholder:"Paste raw SMS text here...",value:l.data.raw_sms,onChange:i=>l.setData("raw_sms",i.target.value),className:"w-full bg-gray-50 border border-gray-200 text-gray-800 rounded-lg px-3 py-2 text-sm min-h-[80px] outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"}),l.errors.raw_sms&&e.jsx("div",{className:"text-red-500 text-xs",children:l.errors.raw_sms}),e.jsxs("button",{disabled:l.processing,className:"w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-70 text-white font-medium py-2 rounded-lg text-sm transition-colors flex justify-center items-center gap-2",children:[l.processing&&e.jsx($,{size:16,className:"animate-spin"}),"Process SMS"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-indigo-600 font-semibold",children:[e.jsx(oe,{size:18}),e.jsx("h2",{children:"Upload Statement"})]}),e.jsxs("form",{onSubmit:x,className:"space-y-3",children:[e.jsx("input",{type:"file",accept:".pdf,.csv,.xls,.xlsx,.png,.jpg,.jpeg",onChange:i=>c.setData("statement",i.target.files[0]),className:"w-full bg-gray-50 border border-gray-200 text-gray-800 rounded-lg px-3 py-1.5 text-sm file:mr-4 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"}),c.errors.statement&&e.jsx("div",{className:"text-red-500 text-xs",children:c.errors.statement}),e.jsxs("button",{disabled:c.processing||!c.data.statement,className:"w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-70 text-white font-medium py-2 rounded-lg text-sm transition-colors mt-auto flex justify-center items-center gap-2",children:[c.processing&&e.jsx($,{size:16,className:"animate-spin"}),"Upload File"]})]})]})]}),a.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 mt-10",children:[e.jsx("div",{className:"w-1.5 h-6 bg-[#4F46E5] rounded-full"}),e.jsxs("h1",{className:"text-lg font-bold text-[#1E293B] tracking-tight flex items-center gap-3",children:["PENDING REVIEW",e.jsx("span",{className:"bg-[#E0E7FF] text-[#4338CA] text-xs py-0.5 px-2.5 rounded-full font-bold",children:a.length})]})]}),e.jsx("div",{className:"space-y-6",children:a.map(i=>e.jsx(z,{transaction:i,heads:n},i.id))})]}),p.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 mt-12",children:[e.jsx("div",{className:"w-1.5 h-6 bg-[#10B981] rounded-full"}),e.jsx("h1",{className:"text-lg font-bold text-[#1E293B] tracking-tight flex items-center gap-3",children:"RECENTLY COMPLETED"})]}),e.jsx("div",{className:"space-y-6",children:p.map(i=>e.jsx(z,{transaction:i,heads:n},i.id))})]})]})]})}export{ye as default};
