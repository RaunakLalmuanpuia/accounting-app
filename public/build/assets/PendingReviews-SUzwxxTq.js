import{r as f,a as S,j as e,u as E,H as U,L}from"./app-DH1Rv4bA.js";import{A as V}from"./AuthenticatedLayout-AwICT7uN.js";import{I as _}from"./InputLabel-B3Z7qnh2.js";import{I as w,T as H}from"./TextInput-CvCOP_Rg.js";import{c as m}from"./createLucideIcon-B1fAUQ9H.js";import{a as M,C as O,L as F}from"./loader-circle-Dy8pFtmR.js";import{M as X,A as D}from"./message-square-CMsNOb8e.js";import"./ApplicationLogo-DWV-my25.js";import"./transition-Bi_rvh69.js";const G=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Y=m("building-2",G);const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],$=m("circle-check",J);const Q=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],W=m("credit-card",Q);const K=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Z=m("pen-line",K);const ee=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],se=m("trending-down",ee);const te=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ae=m("trending-up",te);const re=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ne=m("triangle-alert",re);const ie=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],de=m("upload",ie);const oe=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],le=m("wand-sparkles",oe),p=(...a)=>a.filter(Boolean).join(" "),ce=a=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(a),me=(a,x)=>{if(x.narration_sub_head_id)for(const l of a){const d=(l.active_sub_heads||l.sub_heads||[]).find(r=>r.id===x.narration_sub_head_id);if(d)return{head:l,subHead:d}}if(x.narration_head_id){const l=a.find(i=>i.id===x.narration_head_id);if(l)return{head:l,subHead:null}}return{head:null,subHead:null}};function P({transaction:a,heads:x=[]}){const l=a.type==="credit",i=x.filter(t=>t.type===a.type||t.type==="both"),d=a.review_status!=="pending",r=f.useMemo(()=>me(i,a),[i,a]),[y,g]=f.useState(!1),[c,b]=f.useState(r?.head??null),[n,o]=f.useState(r?.subHead??null),[j,N]=f.useState(!1),{data:h,setData:u,post:k,processing:s,errors:v,reset:A}=S({narration_head_id:r?.head?.id??"",narration_sub_head_id:r?.subHead?.id??"",party_name:a.party_name??"",narration_note:a.narration_note??"",save_as_rule:!1}),R=t=>{b(t),o(null),u(q=>({...q,narration_head_id:t.id,narration_sub_head_id:""}))},I=t=>{n?.id===t.id?(o(null),u("narration_sub_head_id","")):(o(t),u("narration_sub_head_id",t.id))},T=()=>{if(!h.narration_head_id){g(!0);return}C()},C=t=>{t&&t.preventDefault(),k(route("banking.transactions.review",{transaction:a.id,action:"correct"}),{preserveScroll:!0,onSuccess:()=>g(!1)})},B=()=>{g(!1),b(r?.head??null),o(r?.subHead??null),N(!1),A()},z=c?.active_sub_heads||c?.sub_heads||[];return e.jsxs("div",{className:p("rounded-2xl shadow-sm border overflow-hidden transition-all relative",d?"bg-gray-50 border-gray-200":"bg-white border-gray-100"),children:[a.is_uncertain&&!d&&e.jsxs("div",{className:"absolute top-2 right-4 flex items-center gap-1 text-amber-500 bg-amber-50 px-2 py-1 rounded text-xs font-bold ring-1 ring-amber-200",children:[e.jsx(ne,{size:12})," Low Confidence"]}),e.jsx("div",{className:p("text-white text-[10px] font-bold px-4 py-1.5 text-center tracking-widest uppercase",d?"bg-emerald-500":"bg-indigo-600"),children:d?"Reviewed":"Pending"}),e.jsx("div",{className:"p-5 sm:p-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:p("flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center",l?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"),children:l?e.jsx(ae,{size:24}):e.jsx(se,{size:24})}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("h3",{className:p("text-lg font-semibold mb-1",d?"text-gray-600":"text-gray-800"),children:[ce(a.amount)," ",l?"received":"debit for"," ",h.party_name?`'${h.party_name}'`:""]}),e.jsx("p",{className:"text-sm text-gray-500 font-mono mb-4",children:a.raw_narration}),y?e.jsxs("form",{onSubmit:C,className:"mt-4 animate-in fade-in duration-200 border-t border-gray-200 pt-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx(_,{value:"1. Select Head *",className:"mb-2 text-gray-500 uppercase text-[10px] tracking-widest font-bold"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:i.map(t=>e.jsx("button",{type:"button",onClick:()=>R(t),className:p("flex items-center justify-center rounded-xl border-2 py-2 px-2 text-xs font-bold transition-all",c?.id===t.id?"border-indigo-600 bg-indigo-50 text-indigo-700 shadow-sm":"border-gray-100 bg-white text-gray-500 hover:border-gray-300"),children:t.name},t.id))}),e.jsx(w,{message:v.narration_head_id,className:"mt-2"})]}),c&&z.length>0&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(_,{value:"2. Sub-Head (Optional)",className:"mb-2 text-gray-500 uppercase text-[10px] tracking-widest font-bold"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:z.map(t=>e.jsxs("button",{type:"button",onClick:()=>I(t),className:p("flex items-center justify-between rounded-xl border-2 px-4 py-2.5 text-left text-sm font-medium transition-all",n?.id===t.id?"border-gray-900 bg-gray-900 text-white shadow-md":"border-gray-100 bg-white text-gray-600 hover:border-gray-300"),children:[t.name,n?.id===t.id&&e.jsx("span",{className:"text-indigo-400",children:"●"})]},t.id))}),e.jsx(w,{message:v.narration_sub_head_id,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:`party_${a.id}`,value:n?.requires_party?"Party Name *":"Vendor Name (Optional)",className:"mb-1"}),e.jsx(H,{id:`party_${a.id}`,value:h.party_name,onChange:t=>u("party_name",t.target.value),className:"w-full bg-gray-50 border-gray-200 text-sm",placeholder:"Vendor/Person name",required:n?.requires_party}),e.jsx(w,{message:v.party_name,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:`note_${a.id}`,value:"Additional Note (Optional)",className:"mb-1"}),e.jsx(H,{id:`note_${a.id}`,value:h.narration_note,onChange:t=>u("narration_note",t.target.value),className:"w-full bg-gray-50 border-gray-200 text-sm",placeholder:"Add specific details..."}),e.jsx(w,{message:v.narration_note,className:"mt-1"})]})]}),e.jsx("div",{className:p("rounded-xl border-2 p-3.5 transition-colors",j?"border-indigo-100 bg-indigo-50/30":"border-gray-50 bg-gray-50/50"),children:e.jsxs("label",{className:"flex cursor-pointer items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:t=>{N(t.target.checked),u("save_as_rule",t.target.checked)},className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800",children:"Auto-categorize in future?"}),e.jsx("span",{className:"text-[10px] text-gray-500 leading-tight",children:"Remember this choice for similar narrations."})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:B,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-xl transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!c||s,className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white text-sm font-semibold rounded-xl shadow-sm transition-colors",children:s?"Saving...":d?"Update Details":"Confirm Details"})]})]}):e.jsxs(e.Fragment,{children:[!d&&(a.reasoning||r?.head)&&e.jsxs("div",{className:"bg-[#F8FAFC] border border-indigo-50 rounded-xl p-3 mb-5 flex gap-3 text-sm text-gray-500 italic",children:[e.jsx(le,{size:16,className:"text-indigo-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[r?.head&&e.jsxs("span",{className:"block not-italic font-semibold text-indigo-700 mb-0.5",children:["Suggested: ",r.head.name," ",r.subHead?`→ ${r.subHead.name}`:""]}),e.jsxs("p",{children:["Narration: ",a.narration_note]}),e.jsx("br",{}),e.jsx("p",{children:a.reasoning||"AI mapped this based on similar patterns."})]})]}),d&&r?.head&&e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 rounded-xl p-3 mb-5 flex gap-3 text-sm",children:[e.jsx(M,{size:18,className:"text-emerald-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("span",{className:"block font-semibold text-emerald-800 mb-0.5",children:["Categorized as: ",r.head.name," ",r.subHead?`→ ${r.subHead.name}`:""]}),a.narration_note&&e.jsxs("p",{className:"text-emerald-600/80 italic text-xs",children:["Note: ",a.narration_note]})]})]}),e.jsx("div",{className:"flex gap-3",children:d?e.jsxs("button",{onClick:()=>g(!0),className:"w-full bg-white border-2 border-gray-200 hover:border-gray-300 text-gray-600 font-semibold py-2 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Z,{size:18})," Edit"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:T,disabled:s,className:"flex-1 bg-[#10B981] hover:bg-[#059669] disabled:opacity-50 text-white font-semibold py-2.5 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors",children:[e.jsx(M,{size:20})," Yes, Confirm"]}),e.jsx("button",{onClick:()=>g(!0),className:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2.5 px-4 rounded-xl transition-colors",children:r?.head?"Enter Narration":"Categorize"})]})})]})]})]})})]})}function xe(){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-50 border-2 border-amber-200 rounded-2xl flex items-center justify-center mb-5",children:e.jsx(Y,{className:"text-amber-500",size:28})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"No Company Profile Found"}),e.jsx("p",{className:"text-gray-500 text-sm max-w-xs mb-6 leading-relaxed",children:"You need to set up your company profile before you can manage banking transactions."}),e.jsxs(L,{href:route("accounting.chat"),className:"inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold px-5 py-2.5 rounded-xl transition-colors shadow-sm",children:["Set Up Company",e.jsx(D,{size:15})]})]})}function ge(){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 border-2 border-blue-200 rounded-2xl flex items-center justify-center mb-5",children:e.jsx(W,{className:"text-blue-500",size:28})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"No Bank Account Added"}),e.jsx("p",{className:"text-gray-500 text-sm max-w-xs mb-6 leading-relaxed",children:"Add a bank account to your company profile to start tracking and reviewing transactions."}),e.jsxs(L,{href:route("accounting.chat"),className:"inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold px-5 py-2.5 rounded-xl transition-colors shadow-sm",children:["Add Bank Account",e.jsx(D,{size:15})]})]})}function ue(){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-14 px-6 text-center",children:[e.jsx("div",{className:"w-14 h-14 bg-emerald-50 border-2 border-emerald-200 rounded-2xl flex items-center justify-center mb-4",children:e.jsx($,{className:"text-emerald-500",size:24})}),e.jsx("h3",{className:"text-base font-semibold text-gray-700 mb-1",children:"All caught up!"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"No transactions to review right now."})]})}function we({auth:a,transactions:x,heads:l,bankAccounts:i=[],hasCompany:d=!0}){const{flash:r}=E().props,y=i.length===0,g=x?.data||[],c=g.filter(s=>s.review_status==="pending"),b=g.filter(s=>s.review_status!=="pending"),n=S({bank_account_id:i.length>0?i[0].id:"",raw_sms:""}),o=S({bank_account_id:i.length>0?i[0].id:"",statement:null}),j=s=>{s.preventDefault(),n.post(route("banking.transactions.sms.ingest"),{onSuccess:()=>n.reset("raw_sms")})},N=s=>{s.preventDefault(),o.post(route("banking.transactions.statement.upload"),{forceFormData:!0,onSuccess:()=>o.reset("statement")})},h=!d,u=d&&y,k=d&&!y;return e.jsxs(V,{user:a.user,children:[e.jsx(U,{title:"Pending Reviews"}),e.jsxs("div",{className:"max-w-2xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Narration"}),e.jsx("p",{className:"text-sm text-gray-400 mt-0.5",children:"Review and categorise your transactions"})]}),r?.success&&e.jsxs("div",{className:"flex items-start gap-3 bg-emerald-50 text-emerald-700 p-4 rounded-xl border border-emerald-200 text-sm font-medium",children:[e.jsx($,{size:16,className:"mt-0.5 flex-shrink-0"}),r.success]}),r?.error&&e.jsxs("div",{className:"flex items-start gap-3 bg-red-50 text-red-700 p-4 rounded-xl border border-red-200 text-sm font-medium",children:[e.jsx(O,{size:16,className:"mt-0.5 flex-shrink-0"}),r.error]}),h&&e.jsx("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm",children:e.jsx(xe,{})}),u&&e.jsx("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm",children:e.jsx(ge,{})}),k&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-indigo-600 font-semibold",children:[e.jsx(X,{size:17}),e.jsx("h2",{className:"text-sm",children:"Paste Bank SMS"})]}),i.length>1&&e.jsx("select",{value:n.data.bank_account_id,onChange:s=>n.setData("bank_account_id",s.target.value),className:"w-full bg-gray-50 border border-gray-200 text-gray-800 rounded-lg px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 mb-3",children:i.map(s=>e.jsxs("option",{value:s.id,children:[s.bank_name," — ···",s.account_number.slice(-4)]},s.id))}),e.jsxs("form",{onSubmit:j,className:"space-y-3",children:[e.jsx("textarea",{placeholder:"Paste raw SMS text here...",value:n.data.raw_sms,onChange:s=>n.setData("raw_sms",s.target.value),className:"w-full bg-gray-50 border border-gray-200 text-gray-800 rounded-lg px-3 py-2 text-sm min-h-[90px] outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 resize-none"}),n.errors.raw_sms&&e.jsx("p",{className:"text-red-500 text-xs",children:n.errors.raw_sms}),e.jsxs("button",{type:"submit",disabled:n.processing||!n.data.raw_sms.trim(),className:"w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white font-medium py-2 rounded-lg text-sm transition-colors flex justify-center items-center gap-2",children:[n.processing&&e.jsx(F,{size:15,className:"animate-spin"}),"Process SMS"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-indigo-600 font-semibold",children:[e.jsx(de,{size:17}),e.jsx("h2",{className:"text-sm",children:"Upload Statement"})]}),i.length>1&&e.jsx("select",{value:o.data.bank_account_id,onChange:s=>o.setData("bank_account_id",s.target.value),className:"w-full bg-gray-50 border border-gray-200 text-gray-800 rounded-lg px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 mb-3",children:i.map(s=>e.jsxs("option",{value:s.id,children:[s.bank_name," — ···",s.account_number.slice(-4)]},s.id))}),e.jsxs("form",{onSubmit:N,className:"space-y-3",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"file",accept:".pdf,.csv,.xls,.xlsx,.png,.jpg,.jpeg",onChange:s=>o.setData("statement",s.target.files[0]),className:`w-full bg-gray-50 border border-gray-200 text-gray-800 rounded-lg px-3 py-1.5 text-sm
                                                file:mr-3 file:py-1 file:px-3 file:rounded-md file:border-0
                                                file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700
                                                hover:file:bg-indigo-100 outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500`})}),o.errors.statement&&e.jsx("p",{className:"text-red-500 text-xs",children:o.errors.statement}),e.jsx("p",{className:"text-xs text-gray-400",children:"Supported: PDF, CSV, XLS, XLSX, PNG, JPG"}),e.jsxs("button",{type:"submit",disabled:o.processing||!o.data.statement,className:"w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 text-white font-medium py-2 rounded-lg text-sm transition-colors flex justify-center items-center gap-2",children:[o.processing&&e.jsx(F,{size:15,className:"animate-spin"}),"Upload File"]})]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-5 mt-4",children:[e.jsx("div",{className:"w-1 h-5 bg-indigo-500 rounded-full"}),e.jsxs("h2",{className:"text-sm font-bold text-gray-700 uppercase tracking-widest flex items-center gap-2",children:["Pending Review",c.length>0&&e.jsx("span",{className:"bg-indigo-100 text-indigo-700 text-xs py-0.5 px-2 rounded-full font-bold",children:c.length})]})]}),c.length===0?e.jsx(ue,{}):e.jsx("div",{className:"space-y-4",children:c.map(s=>e.jsx(P,{transaction:s,heads:l},s.id))})]}),b.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-5 mt-8",children:[e.jsx("div",{className:"w-1 h-5 bg-emerald-400 rounded-full"}),e.jsx("h2",{className:"text-sm font-bold text-gray-700 uppercase tracking-widest",children:"Recently Reviewed"})]}),e.jsx("div",{className:"space-y-4",children:b.map(s=>e.jsx(P,{transaction:s,heads:l},s.id))})]})]})]})]})}export{we as default};
